<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Node.as</title>
<link rel="stylesheet" type="text/css" href="../../../../../SourceStyles.css"/>
</head>

<body><pre><span class="asPackage">package</span> cn.com.ultrapower.topology
<span class="asBracket">{</span>
    <span class="asReserved">import</span> mx.controls.Image;
    <span class="asReserved">import</span> mx.controls.Label;
    <span class="asReserved">import</span> mx.containers.VBox;
    
    <span class="asReserved">import</span> flash.events.MouseEvent;
    
    <span class="asReserved">public</span> <span class="asClass">class</span> Node <span class="asReserved">extends</span> VBox
    <span class="asBracket">{</span>
        <span class="asBracket">[</span>Embed<span class="asBracket">(</span>source<span class="asOperator">=</span><span class="asString">&quot;/assets/icon.swf&quot;</span>, symbol<span class="asOperator">=</span><span class="asString">&quot;icon1&quot;</span><span class="asBracket">)]</span>
        <span class="asReserved">private</span> <span class="asVar">var</span> icon1<span class="asOperator">:</span>Class;
        <span class="asBracket">[</span>Embed<span class="asBracket">(</span>source<span class="asOperator">=</span><span class="asString">&quot;/assets/icon.swf&quot;</span>, symbol<span class="asOperator">=</span><span class="asString">&quot;icon2&quot;</span><span class="asBracket">)]</span>
        <span class="asReserved">private</span> <span class="asVar">var</span> icon2<span class="asOperator">:</span>Class;
        <span class="asBracket">[</span>Embed<span class="asBracket">(</span>source<span class="asOperator">=</span><span class="asString">&quot;/assets/icon.swf&quot;</span>, symbol<span class="asOperator">=</span><span class="asString">&quot;icon3&quot;</span><span class="asBracket">)]</span>
        <span class="asReserved">private</span> <span class="asVar">var</span> icon3<span class="asOperator">:</span>Class;
        <span class="asBracket">[</span>Embed<span class="asBracket">(</span>source<span class="asOperator">=</span><span class="asString">&quot;/assets/icon.swf&quot;</span>, symbol<span class="asOperator">=</span><span class="asString">&quot;icon4&quot;</span><span class="asBracket">)]</span>
        <span class="asReserved">private</span> <span class="asVar">var</span> icon4<span class="asOperator">:</span>Class;
        
        <span class="asReserved">private</span> <span class="asVar">var</span> _icon<span class="asOperator">:</span>Image; <span class="asComment">// 图标
</span>        <span class="asReserved">private</span> <span class="asVar">var</span> _title<span class="asOperator">:</span>Label; <span class="asComment">// 标题
</span>        
        <span class="asReserved">private</span> <span class="asVar">var</span> _children<span class="asOperator">:</span>Array; <span class="asComment">// 子节点集合
</span>        <span class="asReserved">private</span> <span class="asVar">var</span> _parent<span class="asOperator">:</span>Array;   <span class="asComment">// 父节点集合
</span>        
        <span class="asReserved">private</span> <span class="asVar">var</span> _id<span class="asOperator">:</span>uint;      <span class="asComment">// 数字 id
</span>        <span class="asReserved">private</span> <span class="asVar">var</span> _name<span class="asOperator">:</span>String;  <span class="asComment">// 文字 id, 对应 xml 的 id
</span>        <span class="asReserved">private</span> <span class="asVar">var</span> _type<span class="asOperator">:</span>String;  <span class="asComment">// 图标类型
</span>        
        <span class="asReserved">public</span> <span class="asFunction">function</span> Node<span class="asBracket">(</span>id<span class="asOperator">:</span>uint, data<span class="asOperator">:</span>XML<span class="asBracket">){</span>
            <span class="asTrace">trace</span><span class="asBracket">(</span><span class="asString">&quot;节点&quot;</span>, id, <span class="asString">&quot;创建成功!&quot;</span><span class="asBracket">)</span>;
            <span class="asReserved">super</span><span class="asBracket">()</span>;
            
            _id <span class="asOperator">=</span> id;
            _children <span class="asOperator">=</span> <span class="asReserved">new</span> Array<span class="asBracket">()</span>;
            _parent   <span class="asOperator">=</span> <span class="asReserved">new</span> Array<span class="asBracket">()</span>;
            
            init<span class="asBracket">(</span>data<span class="asBracket">)</span>;
        <span class="asBracket">}</span>
        
        <span class="asDoc">/**
         * 初始化
         * */</span>
        <span class="asReserved">private</span> <span class="asFunction">function</span> init<span class="asBracket">(</span>data<span class="asOperator">:</span>XML<span class="asBracket">)</span><span class="asOperator">:</span><span class="asReserved">void</span><span class="asBracket">{</span>
            _name <span class="asOperator">=</span> data.@id;
            _type <span class="asOperator">=</span> data.@type;
            <span class="asReserved">this</span>.toolTip <span class="asOperator">=</span> data.@describe;
            <span class="asReserved">this</span>.setStyle<span class="asBracket">(</span><span class="asString">&quot;horizontalAlign&quot;</span>,<span class="asString">&quot;center&quot;</span><span class="asBracket">)</span>;
            
            _icon <span class="asOperator">=</span> <span class="asReserved">new</span> Image<span class="asBracket">()</span>;
            _icon.source <span class="asOperator">=</span> getIcon<span class="asBracket">(</span>_type<span class="asBracket">)</span>;
            <span class="asReserved">this</span>.addChild<span class="asBracket">(</span>_icon<span class="asBracket">)</span>;
            
            _title <span class="asOperator">=</span> <span class="asReserved">new</span> Label<span class="asBracket">()</span>;
            _title.text <span class="asOperator">=</span> data.@title;
            <span class="asReserved">this</span>.addChild<span class="asBracket">(</span>_title<span class="asBracket">)</span>;
            
            x <span class="asOperator">=</span> data.@x;
            y <span class="asOperator">=</span> data.@y;
        <span class="asBracket">}</span>

        <span class="asDoc">/**
         * 添加子节点
         * */</span>
        <span class="asReserved">public</span> <span class="asFunction">function</span> addSubNode<span class="asBracket">(</span>node<span class="asOperator">:</span>Node<span class="asBracket">)</span><span class="asOperator">:</span><span class="asReserved">void</span><span class="asBracket">{</span>
            <span class="asReserved">if</span><span class="asBracket">(</span>node <span class="asOperator">&amp;&amp;</span> <span class="asOperator">!</span>inChildren<span class="asBracket">(</span>node<span class="asBracket">)){</span>
                _children.push<span class="asBracket">(</span>node<span class="asBracket">)</span>;
                <span class="asTrace">trace</span><span class="asBracket">(</span><span class="asString">&quot;添加子节点&quot;</span>, node.Name, <span class="asString">&quot;到&quot;</span>, _name, <span class="asString">&quot;.&quot;</span><span class="asBracket">)</span>;
            <span class="asBracket">}</span><span class="asReserved">else</span><span class="asBracket">{</span>
                <span class="asTrace">trace</span><span class="asBracket">(</span><span class="asString">&quot;子节点&quot;</span>, _name, <span class="asString">&quot;添加失败!&quot;</span><span class="asBracket">)</span>;
            <span class="asBracket">}</span>
        <span class="asBracket">}</span>
        
        <span class="asDoc">/**
         * 判断一个节点是否已经在子节点中
         * */</span>
        <span class="asReserved">private</span> <span class="asFunction">function</span> inChildren<span class="asBracket">(</span>node<span class="asOperator">:</span>Node<span class="asBracket">)</span><span class="asOperator">:</span>Boolean<span class="asBracket">{</span>
            <span class="asReserved">for</span> <span class="asBracket">(</span><span class="asVar">var</span> i<span class="asOperator">:</span>uint <span class="asOperator">=</span> 0; i <span class="asOperator">&lt;</span> _children.length; i<span class="asOperator">++</span><span class="asBracket">){</span>
                <span class="asReserved">if</span> <span class="asBracket">(</span>_children<span class="asBracket">[</span>i<span class="asBracket">]</span>.Id <span class="asOperator">==</span> node.Id<span class="asBracket">){</span>
                    <span class="asReserved">return</span> <span class="asReserved">true</span>;
                <span class="asBracket">}</span>
            <span class="asBracket">}</span>
            <span class="asReserved">return</span> <span class="asReserved">false</span>;
        <span class="asBracket">}</span>
        
        <span class="asDoc">/**
         * 判断是否拥有子节点
         * */</span>
        <span class="asReserved">public</span> <span class="asFunction">function</span> hasChild<span class="asBracket">()</span><span class="asOperator">:</span>Boolean<span class="asBracket">{</span>
            <span class="asReserved">return</span> _children.length <span class="asOperator">&gt;</span> 0;
        <span class="asBracket">}</span>
        
        <span class="asDoc">/**
         * 添加父节点
         * */</span>
        <span class="asReserved">public</span> <span class="asFunction">function</span> addParentNode<span class="asBracket">(</span>node<span class="asOperator">:</span>Node<span class="asBracket">)</span><span class="asOperator">:</span><span class="asReserved">void</span><span class="asBracket">{</span>
            <span class="asReserved">if</span><span class="asBracket">(</span>node <span class="asOperator">&amp;&amp;</span> <span class="asOperator">!</span>inParent<span class="asBracket">(</span>node<span class="asBracket">)){</span>
                _parent.push<span class="asBracket">(</span>node<span class="asBracket">)</span>;
                <span class="asTrace">trace</span><span class="asBracket">(</span><span class="asString">&quot;添加父节点&quot;</span>, node.Name, <span class="asString">&quot;到&quot;</span>, _name, <span class="asString">&quot;.&quot;</span><span class="asBracket">)</span>;
            <span class="asBracket">}</span><span class="asReserved">else</span><span class="asBracket">{</span>
                <span class="asTrace">trace</span><span class="asBracket">(</span><span class="asString">&quot;父节点&quot;</span>, _name, <span class="asString">&quot;添加失败!&quot;</span><span class="asBracket">)</span>;
            <span class="asBracket">}</span>
        <span class="asBracket">}</span>
        
        <span class="asDoc">/**
         * 判断一个节点是否已经在父节点中
         * */</span>
        <span class="asReserved">private</span> <span class="asFunction">function</span> inParent<span class="asBracket">(</span>node<span class="asOperator">:</span>Node<span class="asBracket">)</span><span class="asOperator">:</span>Boolean<span class="asBracket">{</span>
            <span class="asReserved">for</span> <span class="asBracket">(</span><span class="asVar">var</span> i<span class="asOperator">:</span>uint <span class="asOperator">=</span> 0; i <span class="asOperator">&lt;</span> _parent.length; i<span class="asOperator">++</span><span class="asBracket">){</span>
                <span class="asReserved">if</span> <span class="asBracket">(</span>_parent<span class="asBracket">[</span>i<span class="asBracket">]</span>.Id <span class="asOperator">==</span> node.Id<span class="asBracket">){</span>
                    <span class="asReserved">return</span> <span class="asReserved">true</span>;
                <span class="asBracket">}</span>
            <span class="asBracket">}</span>
            <span class="asReserved">return</span> <span class="asReserved">false</span>;
        <span class="asBracket">}</span>
        
        <span class="asDoc">/**
         * 判断是否拥有父节点
         * */</span>
        <span class="asReserved">public</span> <span class="asFunction">function</span> hasParent<span class="asBracket">()</span><span class="asOperator">:</span>Boolean<span class="asBracket">{</span>
            <span class="asReserved">return</span> _parent.length <span class="asOperator">&gt;</span> 0;
        <span class="asBracket">}</span>
        
        <span class="asReserved">public</span> <span class="asFunction">function</span> <span class="asReserved">get</span> Id<span class="asBracket">()</span><span class="asOperator">:</span>uint<span class="asBracket">{</span>
            <span class="asReserved">return</span> _id;
        <span class="asBracket">}</span>
        
        <span class="asReserved">public</span> <span class="asFunction">function</span> <span class="asReserved">get</span> Name<span class="asBracket">()</span><span class="asOperator">:</span>String<span class="asBracket">{</span>
            <span class="asReserved">return</span> _name;
        <span class="asBracket">}</span>
        
        <span class="asDoc">/**
         * 子节点集合
         * */</span>
        <span class="asReserved">public</span> <span class="asFunction">function</span> <span class="asReserved">get</span> Children<span class="asBracket">()</span><span class="asOperator">:</span>Array<span class="asBracket">{</span>
            <span class="asReserved">return</span> _children;
        <span class="asBracket">}</span>
        
        <span class="asDoc">/**
         * 父节点集合
         * */</span>
        <span class="asReserved">public</span> <span class="asFunction">function</span> <span class="asReserved">get</span> Parent<span class="asBracket">()</span><span class="asOperator">:</span>Array<span class="asBracket">{</span>
            <span class="asReserved">return</span> _parent;
        <span class="asBracket">}</span>
        
        <span class="asReserved">public</span> <span class="asFunction">function</span> <span class="asReserved">get</span> cx<span class="asBracket">()</span><span class="asOperator">:</span>Number<span class="asBracket">{</span>
            <span class="asReserved">return</span> x <span class="asOperator">+</span> width<span class="asOperator">/</span>2;
        <span class="asBracket">}</span>
        
        <span class="asReserved">public</span> <span class="asFunction">function</span> <span class="asReserved">get</span> cy<span class="asBracket">()</span><span class="asOperator">:</span>Number<span class="asBracket">{</span>
            <span class="asReserved">return</span> y <span class="asOperator">+</span> _icon.height<span class="asOperator">/</span>2;
        <span class="asBracket">}</span>
        
        <span class="asDoc">/**
         * 获取图标类型
         * */</span>
        <span class="asReserved">private</span> <span class="asFunction">function</span> getIcon<span class="asBracket">(</span>type<span class="asOperator">:</span>String<span class="asBracket">)</span><span class="asOperator">:</span>Class<span class="asBracket">{</span>
            <span class="asReserved">switch</span> <span class="asBracket">(</span>type<span class="asBracket">){</span>
                <span class="asReserved">case</span> <span class="asString">&apos;icon2&apos;</span><span class="asOperator">:</span><span class="asBracket">{</span>
                    <span class="asReserved">return</span> icon2;
                <span class="asBracket">}</span>
                <span class="asReserved">case</span> <span class="asString">&apos;icon3&apos;</span><span class="asOperator">:</span><span class="asBracket">{</span>
                    <span class="asReserved">return</span> icon3;
                <span class="asBracket">}</span>
                <span class="asReserved">case</span> <span class="asString">&apos;icon4&apos;</span><span class="asOperator">:</span><span class="asBracket">{</span>
                    <span class="asReserved">return</span> icon4;
                <span class="asBracket">}</span>
                <span class="asReserved">case</span> <span class="asString">&apos;icon1&apos;</span><span class="asOperator">:</span>
                <span class="asReserved">default</span><span class="asOperator">:</span><span class="asBracket">{</span>
                    <span class="asReserved">return</span> icon1;
                <span class="asBracket">}</span>
            <span class="asBracket">}</span>
        <span class="asBracket">}</span>
    <span class="asBracket">}</span>
<span class="asBracket">}</span></pre></body>
</html>
